<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="576px" preserveAspectRatio="none" style="width:967px;height:576px;background:#FFFFFF;" version="1.1" viewBox="0 0 967 576" width="967px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="146.5527" style="stroke:#181818;stroke-width:1.0;" width="10" x="264.5" y="112.7988"/><rect fill="#FFFFFF" height="155.5527" style="stroke:#181818;stroke-width:1.0;" width="10" x="264.5" y="330.9727"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="683.5" y="142.1094"/><rect fill="#FFFFFF" height="87.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="683.5" y="360.2832"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="824.5" y="259.3516"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="824.5" y="389.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="23" x2="23" y1="81.4883" y2="495.5254"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="269.5" x2="269.5" y1="81.4883" y2="495.5254"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="688.5" x2="688.5" y1="81.4883" y2="495.5254"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="829.5" x2="829.5" y1="81.4883" y2="495.5254"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="78.5352">User</text><ellipse cx="23.5" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.5,21.5 L23.5,48.5 M10.5,29.5 L36.5,29.5 M23.5,48.5 L10.5,63.5 M23.5,48.5 L36.5,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="508.0605">User</text><ellipse cx="23.5" cy="519.5137" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.5,527.5137 L23.5,554.5137 M10.5,535.5137 L36.5,535.5137 M23.5,554.5137 L10.5,569.5137 M23.5,554.5137 L36.5,569.5137 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="212.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100" x="219.5" y="70.5352">FE *.miles.com</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="212.5" y="494.5254"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100" x="219.5" y="515.0605">FE *.miles.com</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="638.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="645.5" y="70.5352">Auth GW/MS</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="638.5" y="494.5254"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="645.5" y="515.0605">Auth GW/MS</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="36" x="811.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="818.5" y="70.5352">IDP</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="36" x="811.5" y="494.5254"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="818.5" y="515.0605">IDP</text><rect fill="#FFFFFF" height="146.5527" style="stroke:#181818;stroke-width:1.0;" width="10" x="264.5" y="112.7988"/><rect fill="#FFFFFF" height="155.5527" style="stroke:#181818;stroke-width:1.0;" width="10" x="264.5" y="330.9727"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="683.5" y="142.1094"/><rect fill="#FFFFFF" height="87.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="683.5" y="360.2832"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="824.5" y="259.3516"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="824.5" y="389.5938"/><polygon fill="#181818" points="252.5,108.7988,262.5,112.7988,252.5,116.7988,256.5,112.7988" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="23.5" x2="258.5" y1="112.7988" y2="112.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="30.5" y="108.0566">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="43.5" y="108.0566"> </text><polygon fill="#181818" points="671.5,138.1094,681.5,142.1094,671.5,146.1094,675.5,142.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="274.5" x2="677.5" y1="142.1094" y2="142.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="281.5" y="137.3672">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216" x="294.5" y="137.3672">Check if the user is authenticated.</text><polygon fill="#181818" points="285.5,167.4199,275.5,171.4199,285.5,175.4199,281.5,171.4199" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="279.5" x2="687.5" y1="171.4199" y2="171.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="291.5" y="166.6777">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="304.5" y="166.6777">User is not authenticated (401)</text><polygon fill="#181818" points="34.5,196.7305,24.5,200.7305,34.5,204.7305,30.5,200.7305" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="28.5" x2="263.5" y1="200.7305" y2="200.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="40.5" y="195.9883">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="53.5" y="195.9883">Render the page for a guest user</text><polygon fill="#181818" points="252.5,226.041,262.5,230.041,252.5,234.041,256.5,230.041" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="23.5" x2="258.5" y1="230.041" y2="230.041"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="30.5" y="225.2988">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="43.5" y="225.2988">Click on login button</text><polygon fill="#181818" points="812.5,255.3516,822.5,259.3516,812.5,263.3516,816.5,259.3516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="269.5" x2="818.5" y1="259.3516" y2="259.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="276.5" y="254.6094">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="289.5" y="254.6094">Redirect to IDP Login page</text><line style="stroke:#181818;stroke-width:1.0;" x1="834.5" x2="876.5" y1="288.6621" y2="288.6621"/><line style="stroke:#181818;stroke-width:1.0;" x1="876.5" x2="876.5" y1="288.6621" y2="301.6621"/><line style="stroke:#181818;stroke-width:1.0;" x1="835.5" x2="876.5" y1="301.6621" y2="301.6621"/><polygon fill="#181818" points="845.5,297.6621,835.5,301.6621,845.5,305.6621,841.5,301.6621" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="841.5" y="283.9199">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="854.5" y="283.9199">Login operations</text><polygon fill="#181818" points="285.5,326.9727,275.5,330.9727,285.5,334.9727,281.5,330.9727" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="279.5" x2="828.5" y1="330.9727" y2="330.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="291.5" y="326.2305">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="341" x="304.5" y="326.2305">Redirect to *.miles.com Login redirect url with a token</text><polygon fill="#181818" points="671.5,356.2832,681.5,360.2832,671.5,364.2832,675.5,360.2832" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="274.5" x2="677.5" y1="360.2832" y2="360.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="281.5" y="355.541">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="294.5" y="355.541">Send the token generated by IDP</text><polygon fill="#181818" points="812.5,385.5938,822.5,389.5938,812.5,393.5938,816.5,389.5938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="693.5" x2="818.5" y1="389.5938" y2="389.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="700.5" y="384.8516">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="722.5" y="384.8516">Validate token</text><polygon fill="#181818" points="704.5,414.9043,694.5,418.9043,704.5,422.9043,700.5,418.9043" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="698.5" x2="828.5" y1="418.9043" y2="418.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="710.5" y="414.1621">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="732.5" y="414.1621"> </text><polygon fill="#181818" points="285.5,444.2148,275.5,448.2148,285.5,452.2148,281.5,448.2148" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="279.5" x2="687.5" y1="448.2148" y2="448.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="291.5" y="443.4727">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="363" x="313.5" y="443.4727">Set http-only "Access token" and "Refresh token" cookies</text><polygon fill="#181818" points="34.5,473.5254,24.5,477.5254,34.5,481.5254,30.5,477.5254" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="28.5" x2="263.5" y1="477.5254" y2="477.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="40.5" y="472.7832">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="62.5" y="472.7832">Show user specific data!</text><!--MD5=[3360888508e23d02d88ae30b659f429a]
@startuml
autonumber
actor "User" as User
participant "FE *.miles.com" as FE
participant "Auth GW/MS" as BE
participant IDP

User -> FE
activate FE

FE -> BE: Check if the user is authenticated.
activate BE
BE -> FE: User is not authenticated (401)
deactivate BE

FE - -> User: Render the page for a guest user
User -> FE: Click on login button

FE - -> IDP: Redirect to IDP Login page
deactivate FE
activate IDP

IDP -> IDP: Login operations
IDP - -> FE: Redirect to *.miles.com Login redirect url with a token
deactivate IDP
activate FE

FE -> BE: Send the token generated by IDP
activate BE
BE -> IDP: Validate token
activate IDP
IDP - -> BE
deactivate IDP
BE - -> FE: Set http-only "Access token" and "Refresh token" cookies
deactivate BE
FE - -> User: Show user specific data!

@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: DE
--></g></svg>