@startuml
autonumber
actor "User" as User
participant "FE *.miles.com" as FE
participant "Auth GW/MS" as BE
participant IDP

User -> FE
activate FE

FE -> BE: Check if the user is authenticated.
activate BE
BE -> FE: User is not authenticated (401)
deactivate BE

FE --> User: Render the page for a guest user
User -> FE: Click on login button

FE --> IDP: Redirect to IDP Login page
deactivate FE
activate IDP

IDP -> IDP: Login operations
IDP --> FE: Redirect to *.miles.com Login redirect url with a token
deactivate IDP
activate FE

FE -> BE: Send the token generated by IDP
activate BE
BE -> IDP: Validate token
activate IDP
IDP --> BE
deactivate IDP
BE --> FE: Set http-only "Access token" and "Refresh token" cookies
deactivate BE
FE --> User: Show user specific data!

@enduml